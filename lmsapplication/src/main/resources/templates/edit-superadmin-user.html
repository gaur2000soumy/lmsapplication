<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Edit User</title>
    <th:block th:replace="~{header :: head}"></th:block>
</head>
<body>
<th:block th:replace="~{header :: body}"></th:block>

<section class="main-content">
    <div class="form-container">
        <h3>Edit User Details</h3>

        <form id="editUserForm">
            <input type="hidden" id="userId" name="userId">

            <label for="fullName">Full Name</label>
            <input type="text" id="fullName" name="fullName" required>

            <label for="email">Email</label>
            <input type="text" id="email" name="email" readonly>

            <label for="phoneNumber">Phone Number</label>
            <input type="text" id="phoneNumber" name="phoneNumber" readonly>

            <label for="role">Role</label>
            <input type="text" id="role" name="role" readonly>

            <button type="submit">Update User</button>
        </form>
    </div>
</section>

<th:block th:replace="~{footer :: body}"></th:block>
<script>
    // Load and populate user details when page loads
    document.addEventListener("DOMContentLoaded", async () => {
        const userId = window.location.pathname.split("/").pop();
        const res = await fetch(`/users/${userId}`);
        const user = await res.json();

        document.getElementById("userId").value = user.id;
        document.getElementById("fullName").value = user.fullName;
        document.getElementById("email").value = user.email;
        document.getElementById("phoneNumber").value = user.phoneNumber;
        document.getElementById("role").value = user.role;
        document.getElementById("companyId").value = user.company?.companyId || '';
    });

    // Submit only fullName to update user
    document.getElementById("editUserForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const userId = document.getElementById("userId").value;
        const fullName = document.getElementById("fullName").value;

        const res = await fetch(`/users/${userId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ fullName })
        });

        if (res.ok) {
            alert("User updated successfully!");
            window.location.href = "/superadmin-users";
        } else {
            alert("Failed to update user");
        }
    });
</script>

</body>
</html>
